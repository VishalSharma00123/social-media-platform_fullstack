{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/vishalsharma/Downloads/Social-Media-FullStack/social-frontend/src/components/ChatSocket.tsx"],"sourcesContent":["// components/ChatSocket.tsx\n\n\"use client\";\nimport { useEffect, useRef, useImperativeHandle, forwardRef } from \"react\";\nimport { Client } from \"@stomp/stompjs\";\nimport SockJS from \"sockjs-client\";\nimport { auth } from \"@/lib/auth\";\n\ninterface Props {\n    onMessage: (message: any) => void;\n    onTyping?: (data: any) => void;\n    onConnect?: () => void;\n}\n\nexport interface ChatSocketHandle {\n    sendMessage: (receiverId: string, content: string, conversationId?: string) => void;\n    sendTypingIndicator: (receiverId: string, isTyping: boolean) => void;\n    isConnected: () => boolean;\n}\n\nconst ChatSocket = forwardRef<ChatSocketHandle, Props>(\n    ({ onMessage, onTyping, onConnect }, ref) => {\n        const clientRef = useRef<Client | null>(null);\n        const isConnectedRef = useRef(false);\n\n        // Expose methods to parent component\n        useImperativeHandle(ref, () => ({\n            sendMessage: (receiverId: string, content: string, conversationId?: string) => {\n                if (!clientRef.current || !isConnectedRef.current) {\n                    console.error(\"âŒ WebSocket not connected\");\n                    return;\n                }\n\n                const messageRequest = {\n                    receiverId,\n                    content,\n                    conversationId,\n                };\n\n                console.log(\"ðŸ“¤ Sending message:\", messageRequest);\n\n                clientRef.current.publish({\n                    destination: \"/app/chat.send\",\n                    body: JSON.stringify(messageRequest),\n                });\n            },\n\n            sendTypingIndicator: (receiverId: string, isTyping: boolean) => {\n                if (!clientRef.current || !isConnectedRef.current) {\n                    return;\n                }\n\n                const typingMessage = {\n                    type: \"TYPING\",\n                    userId: receiverId,\n                    isTyping,\n                    timestamp: Date.now(),\n                };\n\n                clientRef.current.publish({\n                    destination: \"/app/chat.typing\",\n                    body: JSON.stringify(typingMessage),\n                });\n            },\n\n            isConnected: () => isConnectedRef.current,\n        }));\n\n        useEffect(() => {\n            const userId = auth.getUser()?.id;\n            if (!userId) return;\n\n            // Create WebSocket connection via SockJS\n            const socket = new SockJS(\"http://localhost:8080/ws\");\n\n            // Create STOMP client\n            const stompClient = new Client({\n                webSocketFactory: () => socket as any,\n                reconnectDelay: 5000,\n                debug: (str) => console.log(\"STOMP:\", str),\n                onConnect: () => {\n                    console.log(\"âœ… WebSocket connected\");\n                    isConnectedRef.current = true;\n                    onConnect?.();\n\n                    // Subscribe to user's message queue\n                    stompClient.subscribe(`/user/${userId}/queue/messages`, (message) => {\n                        const body = JSON.parse(message.body);\n                        console.log(\"ðŸ“© Received message:\", body);\n                        onMessage(body);\n                    });\n\n                    // Subscribe to typing indicators\n                    stompClient.subscribe(`/user/${userId}/queue/typing`, (message) => {\n                        const body = JSON.parse(message.body);\n                        console.log(\"âŒ¨ï¸ Typing indicator:\", body);\n                        onTyping?.(body);\n                    });\n                },\n                onStompError: (frame) => {\n                    console.error(\"STOMP error:\", frame);\n                    isConnectedRef.current = false;\n                },\n                onDisconnect: () => {\n                    console.log(\"âŒ WebSocket disconnected\");\n                    isConnectedRef.current = false;\n                },\n            });\n\n            stompClient.activate();\n            clientRef.current = stompClient;\n\n            return () => {\n                isConnectedRef.current = false;\n                stompClient.deactivate();\n            };\n        }, [onMessage, onTyping, onConnect]);\n\n        return null; // This is a headless component\n    }\n);\n\nChatSocket.displayName = \"ChatSocket\";\n\nexport default ChatSocket;\n"],"names":[],"mappings":"AAAA,4BAA4B;;;;;AAG5B;AACA;AACA;AACA;AAJA;;;;;AAkBA,MAAM,2BAAa,IAAA,yOAAU,EACzB,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,SAAS,EAAE,EAAE;IACjC,MAAM,YAAY,IAAA,qOAAM,EAAgB;IACxC,MAAM,iBAAiB,IAAA,qOAAM,EAAC;IAE9B,qCAAqC;IACrC,IAAA,kPAAmB,EAAC,KAAK,IAAM,CAAC;YAC5B,aAAa,CAAC,YAAoB,SAAiB;gBAC/C,IAAI,CAAC,UAAU,OAAO,IAAI,CAAC,eAAe,OAAO,EAAE;oBAC/C,QAAQ,KAAK,CAAC;oBACd;gBACJ;gBAEA,MAAM,iBAAiB;oBACnB;oBACA;oBACA;gBACJ;gBAEA,QAAQ,GAAG,CAAC,uBAAuB;gBAEnC,UAAU,OAAO,CAAC,OAAO,CAAC;oBACtB,aAAa;oBACb,MAAM,KAAK,SAAS,CAAC;gBACzB;YACJ;YAEA,qBAAqB,CAAC,YAAoB;gBACtC,IAAI,CAAC,UAAU,OAAO,IAAI,CAAC,eAAe,OAAO,EAAE;oBAC/C;gBACJ;gBAEA,MAAM,gBAAgB;oBAClB,MAAM;oBACN,QAAQ;oBACR;oBACA,WAAW,KAAK,GAAG;gBACvB;gBAEA,UAAU,OAAO,CAAC,OAAO,CAAC;oBACtB,aAAa;oBACb,MAAM,KAAK,SAAS,CAAC;gBACzB;YACJ;YAEA,aAAa,IAAM,eAAe,OAAO;QAC7C,CAAC;IAED,IAAA,wOAAS,EAAC;QACN,MAAM,SAAS,gJAAI,CAAC,OAAO,IAAI;QAC/B,IAAI,CAAC,QAAQ;QAEb,yCAAyC;QACzC,MAAM,SAAS,IAAI,iLAAM,CAAC;QAE1B,sBAAsB;QACtB,MAAM,cAAc,IAAI,oLAAM,CAAC;YAC3B,kBAAkB,IAAM;YACxB,gBAAgB;YAChB,OAAO,CAAC,MAAQ,QAAQ,GAAG,CAAC,UAAU;YACtC,WAAW;gBACP,QAAQ,GAAG,CAAC;gBACZ,eAAe,OAAO,GAAG;gBACzB;gBAEA,oCAAoC;gBACpC,YAAY,SAAS,CAAC,CAAC,MAAM,EAAE,OAAO,eAAe,CAAC,EAAE,CAAC;oBACrD,MAAM,OAAO,KAAK,KAAK,CAAC,QAAQ,IAAI;oBACpC,QAAQ,GAAG,CAAC,wBAAwB;oBACpC,UAAU;gBACd;gBAEA,iCAAiC;gBACjC,YAAY,SAAS,CAAC,CAAC,MAAM,EAAE,OAAO,aAAa,CAAC,EAAE,CAAC;oBACnD,MAAM,OAAO,KAAK,KAAK,CAAC,QAAQ,IAAI;oBACpC,QAAQ,GAAG,CAAC,wBAAwB;oBACpC,WAAW;gBACf;YACJ;YACA,cAAc,CAAC;gBACX,QAAQ,KAAK,CAAC,gBAAgB;gBAC9B,eAAe,OAAO,GAAG;YAC7B;YACA,cAAc;gBACV,QAAQ,GAAG,CAAC;gBACZ,eAAe,OAAO,GAAG;YAC7B;QACJ;QAEA,YAAY,QAAQ;QACpB,UAAU,OAAO,GAAG;QAEpB,OAAO;YACH,eAAe,OAAO,GAAG;YACzB,YAAY,UAAU;QAC1B;IACJ,GAAG;QAAC;QAAW;QAAU;KAAU;IAEnC,OAAO,MAAM,+BAA+B;AAChD;AAGJ,WAAW,WAAW,GAAG;uCAEV"}},
    {"offset": {"line": 129, "column": 0}, "map": {"version":3,"sources":["file:///Users/vishalsharma/Downloads/Social-Media-FullStack/social-frontend/src/app/%28app%29/messages/page.tsx"],"sourcesContent":["// app/(app)/messages/page.tsx\n\"use client\";\nimport { useEffect, useState } from \"react\";\nimport api from \"@/lib/api\";\nimport { Conversation } from \"@/lib/types\";\nimport Link from \"next/link\";\nimport { auth } from \"@/lib/auth\";\nimport ChatSocket from \"@/components/ChatSocket\";\n\nexport default function ConversationsPage() {\n    const [conversations, setConversations] = useState<Conversation[]>([]);\n    const [loading, setLoading] = useState(true);\n    const currentUser = auth.getUser();\n\n    useEffect(() => {\n        loadConversations();\n    }, []);\n\n    const loadConversations = async () => {\n        try {\n            const response = await api.get<Conversation[]>(\"/api/conversations\");\n            setConversations(response.data);\n        } catch (error) {\n            console.error(\"Failed to load conversations:\", error);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleWebSocketMessage = (wsMessage: any) => {\n        if (wsMessage.type === \"MESSAGE\" && wsMessage.message) {\n            setConversations((prev) => {\n                const convId = wsMessage.message.conversationId;\n                const existingIndex = prev.findIndex(c => c.id === convId);\n\n                if (existingIndex > -1) {\n                    const updated = [...prev];\n                    updated[existingIndex] = {\n                        ...updated[existingIndex],\n                        lastMessage: wsMessage.message.content,\n                        lastMessageTime: wsMessage.message.createdAt,\n                        updatedAt: wsMessage.message.createdAt,\n                        unreadCount: updated[existingIndex].unreadCount + (wsMessage.userId !== currentUser?.id ? 1 : 0)\n                    };\n                    // Move to top\n                    const movedItem = updated.splice(existingIndex, 1)[0];\n                    return [movedItem, ...updated];\n                } else {\n                    // New conversation - reload list to be safe and fetch user details\n                    loadConversations();\n                    return prev;\n                }\n            });\n        }\n    };\n\n    if (loading) {\n        return (\n            <div className=\"flex flex-col items-center justify-center py-20 space-y-4\">\n                <div className=\"w-12 h-12 border-4 border-primary-100 border-t-primary-600 rounded-full animate-spin\" />\n                <p className=\"text-surface-500 font-bold uppercase tracking-widest text-xs\">Loading conversations...</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"max-w-4xl mx-auto space-y-8 animate-in\">\n            <ChatSocket onMessage={handleWebSocketMessage} />\n            <div className=\"flex items-center justify-between\">\n                <h1 className=\"text-3xl font-black text-surface-900 tracking-tight\">Messages</h1>\n                <button className=\"btn-primary px-6 py-2 rounded-full text-sm\">New Message</button>\n            </div>\n\n            <div className=\"grid grid-cols-1 gap-4\">\n                {conversations.length > 0 ? (\n                    conversations.map((conv) => {\n                        return (\n                            <Link\n                                key={conv.id}\n                                href={`/messages/${conv.id}`}\n                                className=\"card p-5 bg-white border-surface-100 hover:border-primary-200 hover:shadow-lg hover:-translate-y-0.5 transition-all flex items-center justify-between group\"\n                            >\n                                <div className=\"flex items-center space-x-5\">\n                                    <div className=\"relative\">\n                                        <div className=\"w-14 h-14 rounded-full bg-primary-100 flex items-center justify-center text-primary-600 font-bold text-xl overflow-hidden border-2 border-white shadow-sm transition-transform group-hover:scale-105\">\n                                            {conv.otherUserProfilePicture ? (\n                                                <img\n                                                    src={conv.otherUserProfilePicture.startsWith('http') ? conv.otherUserProfilePicture : `http://localhost:8082${conv.otherUserProfilePicture}`}\n                                                    alt={conv.otherUserName}\n                                                    className=\"w-full h-full object-cover\"\n                                                />\n                                            ) : (\n                                                conv.otherUserName?.charAt(0).toUpperCase() || \"C\"\n                                            )}\n                                        </div>\n                                        <div className=\"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full\"></div>\n                                    </div>\n\n                                    <div className=\"space-y-1\">\n                                        <div className=\"flex items-center space-x-2\">\n                                            <h3 className=\"font-bold text-surface-900 group-hover:text-primary-600 transition-colors\">\n                                                {conv.otherUserName}\n                                            </h3>\n                                            <span className=\"text-[10px] font-bold text-surface-400 uppercase tracking-widest\">â€¢ {new Date(conv.updatedAt).toLocaleDateString()}</span>\n                                        </div>\n                                        <p className=\"text-sm text-surface-500 line-clamp-1 max-w-md\">\n                                            {conv.lastMessage || \"No messages yet\"}\n                                        </p>\n                                    </div>\n                                </div>\n\n                                <div className=\"flex items-center space-x-4\">\n                                    {conv.unreadCount > 0 && (\n                                        <span className=\"bg-primary-600 text-white text-[10px] font-bold px-2 py-1 rounded-full min-w-[20px] text-center shadow-md\">\n                                            {conv.unreadCount}\n                                        </span>\n                                    )}\n                                    <span className=\"text-surface-300 group-hover:text-primary-400 transition-colors text-xl\">â€º</span>\n                                </div>\n                            </Link>\n                        );\n                    })\n                ) : (\n                    <div className=\"text-center py-32 bg-white rounded-3xl border border-dashed border-surface-200\">\n                        <span className=\"text-6xl block mb-6\">ðŸ’¬</span>\n                        <p className=\"text-surface-500 font-bold text-lg\">No conversations yet</p>\n                        <p className=\"text-surface-400 text-sm mt-2 mb-8\">Start messaging your friends to see them here!</p>\n                        <Link href=\"/discover\" className=\"btn-primary px-8 py-3 rounded-full\">Find People to Chat</Link>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}